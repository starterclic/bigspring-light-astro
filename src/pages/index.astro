---
import { Image } from "astro:assets";
import Base from "@/layouts/Base.astro";
import Cta from "@/layouts/components/Cta.astro";
import { markdownify } from "@/lib/utils/textConverter";
import { getEntryBySlug } from "astro:content";

const homepage = await getEntryBySlug("homepage", "index");
const { banner, feature, services, workflow, call_to_action } = homepage.data;
---

<Base>
  <!-- banner -->
  <section class="section pb-[50px]">
    <div class="container">
      <div class="row text-center">
        <div class="mx-auto lg:col-10">
          <h1 class="font-primary font-bold">Bienvenue chez Cybtek</h1>
          <p class="mt-4">Votre partenaire clé en main pour les services d'intelligence artificielle. Nous offrons des solutions personnalisées pour les TPE et PME, incluant support hybride avec GPT et assistance humaine, formations, et accompagnement de projet.</p>
          <a class="btn btn-primary mt-4" href="/contact">Contactez-nous</a>
          <Image
            class="mx-auto mt-12"
            src="/images/banner-cybtek.png"
            width={750}
            height={390}
            alt="Image de la bannière Cybtek"
          />
        </div>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="section bg-theme-light">
    <div class="container">
      <div class="text-center">
        <h2>Nos Services</h2>
      </div>
      <div class="mt-8 grid gap-x-8 gap-y-6 sm:grid-cols-2 lg:grid-cols-3">
        <div class="feature-card rounded-xl bg-white p-5 pb-8 text-center">
          <img class="mx-auto" src="/images/service-icon-1.png" width={30} height={30} alt="Icone Service 1" />
          <h3 class="mt-4">Support Hybride</h3>
          <p>Assistance 24/7 avec des chatbots GPT et un support humain via visio et téléassistance.</p>
        </div>
        <div class="feature-card rounded-xl bg-white p-5 pb-8 text-center">
          <img class="mx-auto" src="/images/service-icon-2.png" width={30} height={30} alt="Icone Service 2" />
          <h3 class="mt-4">Formations</h3>
          <p>Des programmes de formation personnalisés pour maîtriser les outils d'IA.</p>
        </div>
        <div class="feature-card rounded-xl bg-white p-5 pb-8 text-center">
          <img class="mx-auto" src="/images/service-icon-3.png" width={30} height={30} alt="Icone Service 3" />
          <h3 class="mt-4">Accompagnement de Projet</h3>
          <p>Support complet pour vos projets d'intelligence artificielle, de la conception à la mise en œuvre.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Services -->
  {
    services!.map((service: any, index: number) => {
      const isOdd = index % 2 > 0;
      return (
        <section class={`section ${isOdd && "bg-theme-light"}`}>
          <div class="container">
            <div class="items-center gap-8 md:grid md:grid-cols-2">
              <div class={`service-carousel ${!isOdd && "md:order-2"}`}>
                {service!.images!.length > 1 ? (
                  <div class="swiper">
                    <div class="swiper-wrapper">
                      {service!.images?.map((image: string) => (
                        <div class="swiper-slide">
                          <Image
                            class="mx-auto"
                            src={image}
                            width={538}
                            height={328}
                            alt=""
                          />
                        </div>
                      ))}
                    </div>
                    <div class="pagination" />
                  </div>
                ) : (
                  <Image
                    class="mx-auto"
                    src={service!.images![0]}
                    width={538}
                    height={328}
                    alt=""
                  />
                )}
              </div>

              {/* Content */}
              <div
                class={`service-content mt-5 md:mt-0 ${!isOdd && "md:order-1"}`}
              >
                <h2 class="font-bold leading-[40px]">{service?.title}</h2>
                <p class="mt-4 mb-2">{service?.content}</p>
                {service?.button?.enable && (
                  <a
                    href={service?.button.link}
                    class="cta-link inline-flex items-center text-primary"
                  >
                    {service?.button.label}
                    <img
                      class="ml-1"
                      src="/images/arrow-right.svg"
                      width={18}
                      height={14}
                      alt="arrow"
                    />
                  </a>
                )}
              </div>
            </div>
          </div>
        </section>
      );
    })
  }

  <script>
    import { Swiper } from "swiper";
    import "swiper/css";
    import "swiper/css/pagination";
    import { Autoplay, Pagination } from "swiper/modules";

    // astro:page-load event is fired when the page is loaded
    document.addEventListener("astro:page-load", () => {
      new Swiper(".service-carousel .swiper", {
        modules: [Pagination, Autoplay],
        autoplay: {
          delay: 3000,
        },
        pagination: {
          type: "bullets",
          el: ".service-carousel .pagination",
          clickable: true,
        },
      });
    });
  </script>
  <!-- ./End service -->

  <!-- Workflow -->
  <section class="section pb-0">
    <div class="mb-8 text-center">
      <h2
        class="mx-auto max-w-[400px] font-bold leading-[44px]"
      >Notre Processus</h2>
      <p class="mt-3">Découvrez comment nous travaillons chez Cybtek pour fournir les meilleures solutions d'IA.</p>
    </div>
    <Image
      src="/images/workflow-cybtek.png"
      alt="workflow image"
      width={1920}
      height={414}
    />
  </section>

  <!-- Call to Action -->
  <Cta cta={call_to_action} />
</Base>
